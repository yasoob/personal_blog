var __e=window.__e||[];
(function($){var $w=$(window),$d=$(document),logger=!!window.TWP&&!!TWP.Tools&&!!TWP.Tools.logger?new TWP.Tools.logger("pb-f-homepage-story"):window.console;var feature={handleTimestamps:function(){var $items=$(".flex-item");$items.each(function(){var $feature=$(this);var $timestamps=$feature.find("*[data-timestamp][data-timestamp-duration]");var now=(new Date).getTime();$timestamps.each(function(){try{var $e=$(this);var duration=$e.attr("data-timestamp-duration");var hoursAgo=Math.floor((now-$e.attr("data-timestamp"))/
(1*60*60*1E3));if(hoursAgo<=duration){try{$e.text(wp_pb.StaticMethods.getTwitterTime($e.attr("data-timestamp")/1))}catch(e){}$e.show().css({display:"inline-block"})}else{var $p=$e.parent();$e.remove();if(!$.trim($p.html()))$p.remove()}}catch(e){$e.show()}})})},handleFlippers:function(){var $flippers=$(".flex-flipper.unprocessed");if($flippers.length>0){wp_pb.StaticMethods.handleFlexFlippers();$flippers.each(function(){var $this=$(this),size=$this.children().length,count=0,targetBgColor="";$this.find(".flex-flipper-item,.art-in-flipper").each(function(i){var $item=
$(this),bgColor=$item.css("background-color");if(i==0&&(bgColor=="transparent"||bgColor=="rgba(0, 0, 0, 0)"||bgColor==undefined)){var lookForBgColor=true;$item.parents().filter(function(){var color=$(this).css("background-color");if(lookForBgColor&&color!="transparent"&&color!="rgba(0, 0, 0, 0)"&&color!=undefined){lookForBgColor=false;targetBgColor=color}})}if(targetBgColor)$item.css({"background-color":targetBgColor})});$this.children(":not(:first-child)").hide();$this.removeClass("unprocessed");
var loops=$this.data("maxLoops");loops=isNaN(loops)?100:loops;if(loops>0){var time=$this.data("duration");time=isNaN(time)||time<=0?6E3:time*1E3;var fadeSpeed=$this.data("fadeSpeed");fadeSpeed=isNaN(fadeSpeed)||fadeSpeed<=0?1400:fadeSpeed*1E3;var interval=setInterval(function(){count++;if(count<size*loops){$this.data("count",count);$this.children(":first-child").fadeOut(fadeSpeed).next().show().end().appendTo($this)}if(count>=size*loops){clearInterval(interval);$this.removeClass("equalize-heights");
$this.children().css("height","auto")}},time)}})}},handleImageRefreshRates:function(){var $imgs=$("*[data-refresh-rate-status\x3d'unprocessed'][data-refresh-rate]");if($imgs.length>0){logger.info("handle images with refresh rates");$imgs.each(function(){var $img=$(this),src=$img.attr("src"),rate=$img.attr("data-refresh-rate");$img.attr("data-refresh-rate-status","processed");logger.info("\nimg: "+src+"\nrate: "+Math.round(rate/1E3)+" secs");setInterval(function(){logger.info("\nrefreshing: "+src);
$img.attr("src",src)},rate)})}},handleChartable:function(){var chartContainer=document.getElementById("chartContainer");if(!chartContainer)return;var ts=(new Date).getTime();var chartId=$("#chartContainer").attr("data-chartable-id");var script=document.createElement("script");script.type="text/javascript";script.setAttribute("id","chartScript");script.setAttribute("class","twp-module-chart-embed");script.setAttribute("data-move","false");script.setAttribute("data-data-uri","https://postgraphics.s3.amazonaws.com/chartable/"+
chartId+"/latest.json?v\x3d"+ts);script.setAttribute("data-fallback-image","https://chartable.wpentdev.com/"+chartId+"/2300.jpg");script.src="https://chartable.wpentdev.com/public/TWP.Module.chart.embed-0.0.54.min.js?v\x3d3";$("#chartContainer").empty();chartContainer.appendChild(script)},handleStoryTypeWarnings:function(){$(".story-type-warning").each(function(){var $this=$(this),$open=$this.find(".story-type-warning-tools-open"),$closed=$this.find(".story-type-warning-tools-closed"),timeout=null;
$open.on("click",function(){$this.removeClass("open").addClass("closed",{duration:500});if(timeout)clearTimeout(timeout);timeout=setTimeout(function(){if(!$open.is(":visible"))$closed.trigger("click")},6E4)});$closed.on("click",function(){$this.removeClass("closed").addClass("open",{duration:500})})})},handleFishyContentEdits:function(){try{$('*[data-will-poison-app\x3d"true"]').each(function(){var $el=$(this),msgInfo=_getMessageInfo($el,{textTmpl:"{{type}}: BAD CODING"});$el.removeAttr("data-will-poison-app");
msgInfo.$target.before(msgInfo.html)})}catch(e){logger.error("ERROR in handleFishyContentEdits:"+e)}function _getMessageInfo($el,options){options=$.extend(true,{textTmpl:"{{type}}: BAD CODING",htmlTmpl:'\x3cdiv class\x3d"content-editable-warning"\x3e\x3cspan class\x3d"fa fa-exclamation-triangle"\x3e\x3c/span\x3e {{text}} \x3cspan class\x3d"fa fa-exclamation-triangle"\x3e\x3c/span\x3e\x3c/div\x3e'},options||{});var msgInfo={},type="";if($el.hasClass("blurb")){msgInfo.$target=$el.closest(".blurb");
type="BLURB"}else if($el.hasClass("byline")||$el.parent().hasClass("byline")){msgInfo.$target=$el.closest(".sigline");type="BYLINE"}else if($el.hasClass("caption")){msgInfo.$target=$el.closest(".caption");type="CAPTION"}else if($el.hasClass("deck")||$el.parent().hasClass("deck")){msgInfo.$target=$el.closest(".deck");type="DECK"}else if($el.hasClass("headline")||$el.parent().hasClass("headline")){msgInfo.$target=$el.closest(".headline");type="HEADLINE"}else if($el.hasClass("label-primary")){msgInfo.$target=
$el.closest(".label-wrapper");type="PRIMARY LABEL";if($el.hasClass("label-item"))type="PRIMARY ITEM LABEL"}else if($el.hasClass("label-secondary")){msgInfo.$target=$el.closest(".label-wrapper");type="SECONDARY LABEL"}else{msgInfo.$target=$el;type="TEXT"}msgInfo.text=options.textTmpl.replace("{{type}}",type);msgInfo.html=options.htmlTmpl.replace("{{text}}",msgInfo.text);return msgInfo}},init:function(){var self=this;self.handleTimestamps();if(document.readyState=="complete")self.handleFlippers();else $w.on("load",
function(){self.handleFlippers()});self.handleImageRefreshRates();self.handleFishyContentEdits();self.handleStoryTypeWarnings()}};__e.push(["phase1-1",applyFeature]);function applyFeature(){feature.init();if($w.width()>1024)setInterval(function(){feature.handleTimestamps()},6E4);$d.on("dom-manipulation-complete",function(){feature.handleTimestamps()});setInterval(function(){feature.handleChartable()},6E4)}})(jQuery);
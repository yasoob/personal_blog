{{ if and (or .Site.DisqusShortname .Site.Params.staticman) (not (or .Site.Params.disable_comments .Params.disable_comments)) }}
<section id="comments">
	{{ if .Site.DisqusShortname }}
	<div class="disqus-comments">
		{{ template "_internal/disqus.html" . }}
	</div>
	{{ end }}
	{{ if .Site.Params.staticman }}
	<section class="staticman-comments post-comments">
		<h3>Comments</h3>

		{{ $comments := readDir "data/comments" }}
		{{ $.Scratch.Add "hasComments" 0 }}
		{{ $postSlug := .File.BaseFileName }}

		{{ range $comments }}
		{{ if eq .Name $postSlug }}
		{{ $.Scratch.Add "hasComments" 1 }}
		{{ range $index, $comments := (index $.Site.Data.comments $postSlug ) }}            
		<div id="commentid-{{ ._id }}" class="post-comment">
			<div class="post-comment-header">
				<img class="post-comment-avatar" src="https://www.gravatar.com/avatar/{{ .email }}?s=70&r=pg&d=identicon">
				<p class="post-comment-info">
					<span class="post-comment-name">{{ .name }}</span>
					<br>
					<a href="#commentid-{{ ._id }}" title="Permalink to this comment">
						<time class="post-time">{{ dateFormat "Monday, Jan 2, 2006 at 15:04 MST" .date }}</time>
					</a>
				</p>
			</div>
			{{ .comment | markdownify }}
		</div>
		{{ end }}       
		{{ end }}
		{{ end }}

		{{ if eq ($.Scratch.Get "hasComments") 0 }}
		<p>Be the first to leave a comment.</p>
		{{ end }}

		<h3>Say something</h3>
		Your email is used for <a href="https://gravatar.com" target="_blank">Gravatar</a> image and reply notifications only.


		<form class="post-new-comment" method="post" action="{{ .Site.Params.staticman.endpoint }}/{{ .Site.Params.staticman.username }}/{{ .Site.Params.staticman.repository }}/{{ .Site.Params.staticman.branch }}/comments">
			<input name="options[redirect]" type="hidden" value="https://yasoob.me">
			  <!-- e.g. "2016-01-02-this-is-a-post" -->
			  <input name="options[slug]" type="hidden" value="{{ .File.BaseFileName }}">
			  <label><input name="fields[name]" type="text">Name</label>
			  <label><input name="fields[email]" type="email">E-mail</label>
			  <label><textarea name="fields[comment]"></textarea>Message</label>
			  
			  <button type="submit">Go!</button>
		</form>
	</section>

	<div id="comment-submitted" class="dialog">
		<h3>Thank you</h3>
		<p>Your comment has been submitted and will be published once it has been approved.</p>
		<p><a href="https://github.com/{{ .Site.Params.staticman.username }}/{{ .Site.Params.staticman.repository }}/pulls">Click here</a> to see the pull request you generated.</p>

		<p><a href="#" class="btn btn-primary comment-buttons ok">OK</a></p>
	</div>

	{{ end }}
</section>
{{ end }}